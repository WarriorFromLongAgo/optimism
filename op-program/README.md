# op-program
op-program 是 Optimism 中的一个重要组件，主要用于执行和验证 L2 区块的状态转换

实现一个防错程序，该程序通过汇总状态转换来验证来自 L1 输入的 L2 输出。
然后，这个可验证的输出可以解决 L1 上的有争议的输出。

该程序的设计使其能够以确定性的方式运行，这样使用相同输入数据的两次调用不仅会产生相同的输出，还会产生相同的程序执行轨迹。 这允许它作为争议解决过程的一部分在链上虚拟机中运行。


Implements a fault proof program that runs through the rollup state-transition to verify an L2 output from L1 inputs.
This verifiable output can then resolve a disputed output on L1.

The program is designed such that it can be run in a deterministic way such that two invocations with the same input
data will result in not only the same output, but the same program execution trace. This allows it to be run in an
on-chain VM as part of the dispute resolution process.

## Compiling

To build op-program, from within the `op-program` directory run:

```shell
make op-program
```

This resulting executable will be in `./bin/op-program`

## Testing

To run op-program unit tests, from within the `op-program` directory run:

```shell
make test
```

## Running

From within the `op-program` directory, options can be reviewed with:

```shell
./bin/op-program --help
```

## Generating the Absolute Prestate

The absolute pre-state of the op-program can be generated by executing the makefile
`reproducible-prestate` target. Effectively, this builds a docker image specified
by [Dockerfile.repro](./Dockerfile.repro) pinned with the following dependencies:
- golang version `1.21.3`
- alpine `3.18`

After running `make reproducible-prestate`, the following files can be found in
[./bin/](./bin/):
- [`op-program`](./bin/op-program)
- [`op-program-client.elf`](./bin/op-program-client.elf)
- [`prestate.bin.gz`](./bin/prestate.bin.gz)
- [`prestate-proof.json`](./bin/prestate-proof.json)

The `prestate-proof.json` file is what contains the absolute pre-state hash under
the `.pre` key that is also used by the [contracts][ctb] deploy script.

[ctb]: ../packages/contracts-bedrock/
